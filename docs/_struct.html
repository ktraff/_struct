<!DOCTYPE html>

<html>
<head>
  <title>_struct.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>_struct.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <pre><code>_struct.js 0.0.1
http://structjs.org
(c) 2013 Kyle Traff
_struct may be freely distributed under the MIT license.</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="keyword">function</span>() {</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2>Baseline setup</h2>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Establish the root object, <code>window</code> in the browser, or <code>global</code> on the server.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> root = <span class="keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Establish the object that gets returned to break out of a loop iteration.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> breaker = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Create a safe reference to the Underscore object for use below.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> _struct = <span class="keyword">function</span>(obj) {
    <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> _struct) <span class="keyword">return</span> obj;
    <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> _struct)) <span class="keyword">return</span> <span class="keyword">new</span> _struct(obj);
    <span class="keyword">this</span>._wrapped = obj;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Export the Underscore _struct object for <strong>Node.js</strong>, with
backwards-compatibility for the old <code>require()</code> API. If we&#39;re in
the browser, add <code>_struct</code> as a global object via a string identifier,
for Closure Compiler &quot;advanced&quot; mode.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> (<span class="keyword">typeof</span> exports !== <span class="string">'undefined'</span>) {
    <span class="keyword">if</span> (<span class="keyword">typeof</span> module !== <span class="string">'undefined'</span> &amp;&amp; module.exports) {
      exports = module.exports = _struct;
    }
    exports._struct = _struct;
  } <span class="keyword">else</span> {
    root._struct = _struct;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Defining helper functions.</p>
<p>Export a module for <strong>Node.js</strong>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> nodeExports = <span class="function"><span class="keyword">function</span> <span class="params">(name, obj)</span> {</span>
    <span class="keyword">if</span> (<span class="keyword">typeof</span> exports !== <span class="string">'undefined'</span>) {
      <span class="keyword">if</span> (<span class="keyword">typeof</span> module !== <span class="string">'undefined'</span> &amp;&amp; module.exports)
        module.exports[name] = obj;

      exports[name] = obj;
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Used to mix in custom behavior to a struct.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> mixin = <span class="function"><span class="keyword">function</span> <span class="params">(obj, proto)</span> {</span>
    _.each(_.functions(obj), <span class="function"><span class="keyword">function</span> <span class="params">(name)</span> {</span>
      proto[name] = obj[name];
    }, <span class="keyword">this</span>);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>An internal function that returns true if the given object 
represents an object, but not a function or array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> isStrictObject = <span class="function"><span class="keyword">function</span> <span class="params">(obj)</span> {</span>
    <span class="keyword">return</span> _.isObject(obj) &amp;&amp; !_.isFunction(obj) &amp;&amp; !_.isArray(obj);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Simple equality function that returns true if the token <code>==</code>
the given obj.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> equals = <span class="function"><span class="keyword">function</span> <span class="params">(token, obj)</span> {</span>
    <span class="keyword">return</span> token == obj;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Strict form of equals function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> strictEquals = <span class="function"><span class="keyword">function</span> <span class="params">(token, obj)</span> {</span>
    <span class="keyword">return</span> token === obj;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Define a container to keep track of all struct objects.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> structs = {};

  <span class="keyword">var</span> VERSION = <span class="string">'0.0.1'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h2>Underscore Linked List</h2>

            </div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>  structs.list = _struct.list = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>

    List.prototype.VERSION = VERSION;</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Creates a new list object. Pass an array of elements, a valid list struct 
object, or leave empty to initialize an empty list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="function"><span class="keyword">function</span> <span class="title">List</span><span class="params">(obj)</span> {</span>
      <span class="keyword">if</span> (_.isArray(obj))
        <span class="keyword">this</span>.struct = _.reduceRight(obj, <span class="keyword">this</span>._cons, <span class="literal">null</span>, <span class="keyword">this</span>);
      <span class="keyword">else</span> <span class="keyword">if</span> (isStrictObject(obj))
        <span class="keyword">this</span>.struct = obj;
      <span class="keyword">else</span>
        <span class="keyword">this</span>.struct = <span class="literal">null</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Constructs a list element by placing the obj at the head of the list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    List.prototype._cons = <span class="function"><span class="keyword">function</span> <span class="params">(list, obj)</span> {</span>
      <span class="keyword">return</span> { first: obj, rest: list };
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Exports a list instance for use in an <strong>Underscore.js</strong> mixin.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    List.prototype._exports = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
      <span class="keyword">return</span> {
        list: <span class="function"><span class="keyword">function</span> <span class="params">(obj)</span> {</span>
          <span class="keyword">return</span> <span class="keyword">new</span> List(obj);
        }
      };
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>A modified version of _.each made for traversing lists.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    List.prototype.each = <span class="function"><span class="keyword">function</span> <span class="params">(iterator, context)</span> {</span>
      <span class="keyword">var</span> i = <span class="number">0</span>;
      <span class="keyword">var</span> list = <span class="keyword">this</span>.struct;
      <span class="keyword">while</span> (list !== <span class="literal">null</span>) {
        <span class="keyword">if</span> (iterator.call(context, list.first, i++, list) === breaker) <span class="keyword">return</span>;
        list = list.rest;
      }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Retrieves an element from the list, if it exists. Return 
a new list with the found element, or an empty list if not found.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    List.prototype.find = <span class="function"><span class="keyword">function</span> <span class="params">(token, comparator, context)</span> {</span>
      <span class="keyword">var</span> result;
      <span class="keyword">var</span> list = <span class="keyword">this</span>.struct;
      comparator = comparator || equals;
      <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span> <span class="params">(obj, idx, list)</span> {</span>
        <span class="keyword">if</span> (comparator.call(context, token, obj, list)) {
          result = list;
          <span class="keyword">return</span> breaker;
        }
      }, context);
      <span class="keyword">return</span> _.list(result);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Returns an empty list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    List.prototype.empty = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
      <span class="keyword">return</span> _.list();
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Creates a new list, with the given obj inserted at the head of the list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    List.prototype.insert = <span class="function"><span class="keyword">function</span> <span class="params">(obj)</span> {</span>
      <span class="keyword">var</span> struct = <span class="keyword">this</span>._cons(<span class="keyword">this</span>.struct, obj);
      <span class="keyword">return</span> _.list(struct);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Returns true if the current element is empty, and
there exist no pointers to other elements in the list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    List.prototype.isEmpty = <span class="function"><span class="keyword">function</span> <span class="params">(arr)</span> {</span>
      <span class="keyword">return</span> <span class="keyword">this</span>.struct === <span class="literal">null</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Returns the length of the list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    List.prototype.length = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
      <span class="keyword">var</span> count = <span class="number">0</span>;
      <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span> <span class="params">(obj, idx, list)</span> {</span>
        <span class="keyword">if</span> (obj === <span class="literal">null</span>)
          <span class="keyword">return</span> breaker;
        ++count;
      });
      <span class="keyword">return</span> count;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Add your own custom functions to every list object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    List.prototype.mixin = <span class="function"><span class="keyword">function</span> <span class="params">(obj)</span> {</span>
      mixin.apply(<span class="keyword">this</span>, [obj, List.prototype]);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Returns a list whose head is next element in the list. If a 
num is provided, moves num spaces forward in the list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    List.prototype.next = <span class="function"><span class="keyword">function</span> <span class="params">(num)</span> {</span>
      <span class="keyword">var</span> struct = <span class="keyword">this</span>.struct;
      num = isNaN(num) ? <span class="number">1</span> : Math.max(num, <span class="number">1</span>);
      <span class="keyword">while</span> (num-- &gt; <span class="number">0</span> &amp;&amp; struct !== <span class="literal">null</span>)
        struct = struct ? struct.rest : struct;
      <span class="keyword">return</span> _.list(struct);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Returns a list with the given token removed. If no token
is given, removes the current element. If no element could 
be found, returns the original list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    List.prototype.remove = <span class="function"><span class="keyword">function</span> <span class="params">(token, comparator, context)</span> {</span>
      <span class="keyword">if</span> (token === <span class="literal">null</span> || <span class="keyword">this</span>.struct === <span class="literal">null</span>)
        <span class="keyword">return</span> <span class="keyword">this</span>.next();
      <span class="keyword">var</span> result;
      comparator = comparator || equals;
      <span class="keyword">if</span> (comparator.call(context, token, <span class="keyword">this</span>.val()))
        <span class="keyword">return</span> <span class="keyword">this</span>.next();
      <span class="keyword">var</span> struct = <span class="keyword">this</span>._cons(<span class="literal">null</span>, <span class="keyword">this</span>.struct.first);
      <span class="keyword">var</span> curr = struct;
      <span class="keyword">this</span>.next().each(<span class="function"><span class="keyword">function</span> <span class="params">(obj, idx, list)</span> {</span>
        <span class="keyword">if</span> (comparator.call(context, token, obj, list)) {
          curr.rest = list ? list.rest : list;
          <span class="keyword">return</span> breaker;
        } <span class="keyword">else</span> {
          curr.rest = <span class="keyword">this</span>._cons(<span class="literal">null</span>, obj);
          curr = curr.rest;
        }
      }, <span class="keyword">this</span>);
      <span class="keyword">return</span> _.list(struct);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Returns the value of the current element in the zipper. If a
value is provided, update the value of the current element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    List.prototype.val = <span class="function"><span class="keyword">function</span> <span class="params">(value)</span> {</span>
      <span class="keyword">if</span> (!arguments.length)
        <span class="keyword">return</span> <span class="keyword">this</span>.struct ? <span class="keyword">this</span>.struct.first : <span class="keyword">this</span>.struct;
      <span class="keyword">var</span> struct = _.extend({ rest: <span class="literal">null</span> }, <span class="keyword">this</span>.struct, { first: value });
      <span class="keyword">return</span> _.list(struct);
    };

    <span class="keyword">return</span> List;

  }();</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <h2>Underscore Zipper</h2>

            </div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>  structs.zipper = _struct.zipper = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>

    Zipper.prototype.VERSION = VERSION;</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Creates a new zipper object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="function"><span class="keyword">function</span> <span class="title">Zipper</span><span class="params">(obj)</span> {</span>
      <span class="keyword">if</span> (_.isArray(obj))
        <span class="keyword">this</span>.struct = _.reduceRight(obj, <span class="function"><span class="keyword">function</span> <span class="params">(zipper, obj, idx, arr)</span> {</span>
          <span class="keyword">return</span> <span class="keyword">this</span>._cons(zipper, obj, <span class="literal">null</span>);
        }, <span class="literal">null</span>, <span class="keyword">this</span>);
      <span class="keyword">else</span> <span class="keyword">if</span> (isStrictObject(obj))
        <span class="keyword">this</span>.struct = obj;
      <span class="keyword">else</span>
        <span class="keyword">this</span>.struct = <span class="literal">null</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Constructs a zipper element at the beginning of a zipper, which consists of:
1) A path back to the front of the zipper, 
2) The current element, and
3) The rest of the zipper.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Zipper.prototype._cons = <span class="function"><span class="keyword">function</span> <span class="params">(zipper, obj, path)</span> {</span>
      <span class="keyword">var</span> elem = { path: path || <span class="literal">null</span>, curr: obj, rest: zipper };
      <span class="keyword">if</span> (zipper) zipper.path = elem;
      <span class="keyword">return</span> elem;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Exports a zipper instance for use in an <strong>Underscore.js</strong> mixin.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Zipper.prototype._exports = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
      <span class="keyword">return</span> {
        zipper: <span class="function"><span class="keyword">function</span> <span class="params">(obj)</span> {</span>
          <span class="keyword">return</span> <span class="keyword">new</span> Zipper(obj);
        }
      };
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Moves to the first element of the zipper.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Zipper.prototype.head  = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
      <span class="keyword">var</span> struct = <span class="keyword">this</span>.struct;
      <span class="keyword">while</span> (struct !== <span class="literal">null</span> &amp;&amp; struct.path !== <span class="literal">null</span>)
        struct = struct.path;
      <span class="keyword">return</span> _.zipper(struct);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Returns the zipper with the last element removed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Zipper.prototype.init = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">var</span> head = <span class="keyword">this</span>.head();
        <span class="keyword">var</span> struct = head.struct;
        <span class="keyword">while</span> (struct !== <span class="literal">null</span> &amp;&amp; struct.rest !== <span class="literal">null</span>)
          struct = struct.rest;
        <span class="keyword">if</span> (struct &amp;&amp; struct.path) struct.path.rest = <span class="literal">null</span>;
        <span class="keyword">return</span> _.zipper(head.struct);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Inserts an element directly left of the current element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Zipper.prototype.insertLeft = <span class="function"><span class="keyword">function</span> <span class="params">(obj)</span> {</span>
      <span class="keyword">var</span> struct = { path: <span class="keyword">this</span>.struct ? <span class="keyword">this</span>.struct.path : <span class="keyword">this</span>.struct, curr: obj, rest: <span class="keyword">this</span>.struct };
      <span class="keyword">return</span> _.zipper(struct);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Inserts an element directly right of the current element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Zipper.prototype.insertRight = <span class="function"><span class="keyword">function</span> <span class="params">(obj)</span> {</span>
      <span class="keyword">var</span> struct;
      <span class="keyword">if</span> (<span class="keyword">this</span>.struct.rest)
        struct = { path: <span class="keyword">this</span>.struct, curr: obj, rest: <span class="keyword">this</span>.struct.rest.rest };
      <span class="keyword">else</span>
        struct = { path: <span class="keyword">this</span>.struct, curr: obj, rest: <span class="literal">null</span> };
      <span class="keyword">return</span> _.zipper(struct);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Moves to the last element of the zipper.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Zipper.prototype.last  = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
      <span class="keyword">var</span> struct = <span class="keyword">this</span>.struct;
      <span class="keyword">while</span> (struct !== <span class="literal">null</span> &amp;&amp; struct.rest !== <span class="literal">null</span>)
        struct = struct.rest;
      <span class="keyword">return</span> _.zipper(struct);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Moves the cursor left. If a num is provided, moves num places
to the left of the cursor.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Zipper.prototype.left = <span class="function"><span class="keyword">function</span> <span class="params">(num)</span> {</span>
      <span class="keyword">var</span> struct = <span class="keyword">this</span>.struct;
      num = isNaN(num) ? <span class="number">1</span> : Math.max(num, <span class="number">1</span>);
      <span class="keyword">while</span> (num-- &gt; <span class="number">0</span> &amp;&amp; struct !== <span class="literal">null</span>)
        struct = struct ? struct.path : struct;
      <span class="keyword">return</span> _.zipper(struct);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Add your own custom functions to every zipper object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Zipper.prototype.mixin = <span class="function"><span class="keyword">function</span> <span class="params">(obj)</span> {</span>
      mixin.apply(<span class="keyword">this</span>, [obj, Zipper.prototype]);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Removes the current element from the zipper. If a path to the element
exists, points the path to the rest of the zipper.  If no elements 
exist after the current elem, points the current element to the previous
element in the path.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Zipper.prototype.remove = <span class="function"><span class="keyword">function</span> <span class="params">(obj)</span> {</span>
      <span class="keyword">var</span> struct = <span class="keyword">this</span>._cons(<span class="literal">null</span>, <span class="literal">null</span>);
      <span class="keyword">if</span> (<span class="keyword">this</span>.struct) {
        <span class="keyword">if</span> (<span class="keyword">this</span>.struct.path) {
          struct.path = <span class="keyword">this</span>._cons(struct, <span class="keyword">this</span>.struct.path.curr, <span class="keyword">this</span>.struct.path.path);
          struct.path.rest = struct;
        }
        <span class="keyword">if</span> (<span class="keyword">this</span>.struct.rest) {
          struct.curr = <span class="keyword">this</span>.struct.rest.curr;
          struct.rest = <span class="keyword">this</span>._cons(<span class="keyword">this</span>.struct.rest.rest, <span class="keyword">this</span>.struct.rest.curr, struct);
          struct.rest.path = struct;
        } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.struct.path) {
          struct.path = <span class="keyword">this</span>.struct.path.path;
          struct.curr = <span class="keyword">this</span>.struct.path.curr;
        }
      }
      <span class="keyword">return</span> _.zipper(struct);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Moves the cursor right. If a num is provided, moves num places
to the right of the cursor.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Zipper.prototype.right = <span class="function"><span class="keyword">function</span> <span class="params">(num)</span> {</span>
      <span class="keyword">var</span> struct = <span class="keyword">this</span>.struct;
      num = isNaN(num) ? <span class="number">1</span> : Math.max(num, <span class="number">1</span>);
      <span class="keyword">while</span> (num-- &gt; <span class="number">0</span> &amp;&amp; struct !== <span class="literal">null</span>)
        struct = struct ? struct.rest : struct;
      <span class="keyword">return</span> _.zipper(struct);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Returns the tail of the zipper, which includes all elements except
the first element in the zipper.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Zipper.prototype.tail = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">return</span> _.zipper(<span class="keyword">this</span>.head().right().struct);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Returns the value of the current element in the zipper. If a
value is provided, update the value of the current element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Zipper.prototype.val = <span class="function"><span class="keyword">function</span> <span class="params">(value)</span> {</span>
      <span class="keyword">if</span> (!arguments.length)
        <span class="keyword">return</span> <span class="keyword">this</span>.struct ? <span class="keyword">this</span>.struct.curr : <span class="keyword">this</span>.struct;
      <span class="keyword">var</span> struct = _.extend({ path: <span class="literal">null</span>, rest: <span class="literal">null</span> }, <span class="keyword">this</span>.struct, { curr: value });
      <span class="keyword">return</span> _.zipper(struct);
    };

    <span class="keyword">return</span> Zipper;

  }();</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <h2>Underscore Monad</h2>

            </div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Monads provide a way to nest functions of a similar kind in the same container,
acting as a functional pipeline, where data can be processed in steps. They
require a type constructor, as well as a <code>bind()</code> and <code>pipeline()</code> operation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  structs.monad = _struct.monad = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>

    Monad.prototype.VERSION = VERSION;</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Creates a monad object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="function"><span class="keyword">function</span> <span class="title">Monad</span><span class="params">(_cons, bind, pipeline)</span> {</span>
      <span class="keyword">this</span>._cons = _cons;
      <span class="keyword">this</span>.bind = bind;
      <span class="keyword">this</span>.pipeline = pipeline;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Exports a monad instance for use in an <strong>Underscore.js</strong> mixin.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Monad.prototype._exports = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
      <span class="keyword">return</span> {
        monad: <span class="function"><span class="keyword">function</span> <span class="params">(_cons, bind, pipeline)</span> {</span>
          <span class="keyword">return</span> <span class="keyword">new</span> Monad(_cons, bind, pipeline);
        }
      };
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Runs a pipeline of functions defined by the Monad constructor.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Monad.prototype.process = <span class="function"><span class="keyword">function</span> <span class="params">(obj, fns)</span> {</span>
      <span class="keyword">return</span> <span class="keyword">this</span>.pipeline(<span class="keyword">this</span>._cons(obj), fns);
    };

    <span class="keyword">return</span> Monad;

  }();</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>The dequelette below is basically a limited kind of deque, in which there can
only store one, two, three or four items.  It is used to build a <code>deque</code> that
will serve as the structure underlying a finger tree.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _struct.fdequelette = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>

    Dequelette.prototype.VERSION = VERSION;</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>The constructor creates a Dequelette of a specific type depending on 
the number of elements provided. A single-element array creates a <code>One</code>
dequelette, two-element array creates a <code>Two</code> dequelette, etc...</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="function"><span class="keyword">function</span> <span class="title">Dequelette</span><span class="params">(arr)</span> {</span>
      <span class="keyword">if</span> (_.isArray(arr) &amp;&amp; arr.length &gt; <span class="number">1</span>) {
        <span class="keyword">if</span> (arr.length === <span class="number">1</span>)
          <span class="keyword">return</span> <span class="keyword">new</span> One(arr);
        <span class="keyword">else</span> <span class="keyword">if</span> (arr.length === <span class="number">2</span>)
          <span class="keyword">return</span> <span class="keyword">new</span> Two(arr[<span class="number">0</span>], arr[<span class="number">1</span>]);
        <span class="keyword">else</span> <span class="keyword">if</span> (arr.length === <span class="number">3</span>)
          <span class="keyword">return</span> <span class="keyword">new</span> Three(arr[<span class="number">0</span>], arr[<span class="number">1</span>], arr[<span class="number">2</span>]);
        <span class="keyword">else</span> <span class="keyword">if</span> (arr.length === <span class="number">4</span>)
          <span class="keyword">return</span> <span class="keyword">new</span> Four(arr[<span class="number">0</span>], arr[<span class="number">1</span>], arr[<span class="number">2</span>], arr[<span class="number">3</span>]);
      }
      <span class="keyword">else</span> <span class="keyword">if</span> (arr)
        <span class="keyword">return</span> <span class="keyword">new</span> One(arr);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>A dequelette with one object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> One = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>

      SingleDequelette.prototype.VERSION = VERSION;

      SingleDequelette.prototype.TYPE = <span class="string">'one'</span>;

      <span class="function"><span class="keyword">function</span> <span class="title">SingleDequelette</span><span class="params">(obj)</span> {</span>
        <span class="keyword">this</span>.struct = [obj];
      }

      SingleDequelette.prototype.size = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">return</span> <span class="number">1</span>;
      };

      SingleDequelette.prototype.peekLeft =
      SingleDequelette.prototype.peekRight = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">return</span> <span class="keyword">this</span>.val();
      };

      SingleDequelette.prototype.insertLeft = <span class="function"><span class="keyword">function</span> <span class="params">(obj)</span> {</span>
        <span class="keyword">return</span> <span class="keyword">new</span> Two(obj, <span class="keyword">this</span>.struct[<span class="number">0</span>]);
      };

      SingleDequelette.prototype.insertRight = <span class="function"><span class="keyword">function</span> <span class="params">(obj)</span> {</span>
        <span class="keyword">return</span> <span class="keyword">new</span> Two(<span class="keyword">this</span>.struct[<span class="number">0</span>], obj);
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>This should never happen.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      SingleDequelette.prototype.removeLeft = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">return</span> <span class="keyword">this</span>;
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>This should never happen.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      SingleDequelette.prototype.removeRight = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">return</span> <span class="keyword">this</span>;
      };

      SingleDequelette.prototype.val = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">return</span> <span class="keyword">this</span>.struct[<span class="number">0</span>];
      };

      <span class="keyword">return</span> SingleDequelette;

    }();</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>A dequelette with two objects.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> Two = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>

      DoubleDequelette.prototype.VERSION = VERSION;

      DoubleDequelette.prototype.TYPE = <span class="string">'two'</span>;

      <span class="function"><span class="keyword">function</span> <span class="title">DoubleDequelette</span><span class="params">(obj1, obj2)</span> {</span>
        <span class="keyword">this</span>.struct = [obj1, obj2];
      }

      DoubleDequelette.prototype.size = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">return</span> <span class="number">2</span>;
      };

      DoubleDequelette.prototype.peekLeft = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">return</span> <span class="keyword">this</span>.struct[<span class="number">0</span>];
      };

      DoubleDequelette.prototype.peekRight = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">return</span> <span class="keyword">this</span>.struct[<span class="number">1</span>];
      };

      DoubleDequelette.prototype.insertLeft = <span class="function"><span class="keyword">function</span> <span class="params">(obj)</span> {</span>
        <span class="keyword">return</span> <span class="keyword">new</span> Three(obj, <span class="keyword">this</span>.struct[<span class="number">0</span>], <span class="keyword">this</span>.struct[<span class="number">1</span>]);
      };

      DoubleDequelette.prototype.insertRight = <span class="function"><span class="keyword">function</span> <span class="params">(obj)</span> {</span>
        <span class="keyword">return</span> <span class="keyword">new</span> Three(<span class="keyword">this</span>.struct[<span class="number">0</span>], <span class="keyword">this</span>.struct[<span class="number">1</span>], obj);
      };

      DoubleDequelette.prototype.removeLeft = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">return</span> <span class="keyword">new</span> One(<span class="keyword">this</span>.struct[<span class="number">1</span>]);
      };

      DoubleDequelette.prototype.removeRight = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">return</span> <span class="keyword">new</span> One(<span class="keyword">this</span>.struct[<span class="number">0</span>]);
      };

      DoubleDequelette.prototype.val = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">return</span> <span class="keyword">this</span>.struct;
      };

      <span class="keyword">return</span> DoubleDequelette;

    }();</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>A dequelette with three objects.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> Three = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>

      TripleDequelette.prototype.VERSION = VERSION;

      TripleDequelette.prototype.TYPE = <span class="string">'three'</span>;

      <span class="function"><span class="keyword">function</span> <span class="title">TripleDequelette</span><span class="params">(obj1, obj2, obj3)</span> {</span>
        <span class="keyword">this</span>.struct = [obj1, obj2, obj3];
      }

      TripleDequelette.prototype.size = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">return</span> <span class="number">3</span>;
      };

      TripleDequelette.prototype.peekLeft = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">return</span> <span class="keyword">this</span>.struct[<span class="number">0</span>];
      };

      TripleDequelette.prototype.peekRight = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">return</span> <span class="keyword">this</span>.struct[<span class="number">2</span>];
      };

      TripleDequelette.prototype.insertLeft = <span class="function"><span class="keyword">function</span> <span class="params">(obj)</span> {</span>
        <span class="keyword">return</span> <span class="keyword">new</span> Four(obj, <span class="keyword">this</span>.struct[<span class="number">0</span>], <span class="keyword">this</span>.struct[<span class="number">1</span>], <span class="keyword">this</span>.struct[<span class="number">2</span>]);
      };

      TripleDequelette.prototype.insertRight = <span class="function"><span class="keyword">function</span> <span class="params">(obj)</span> {</span>
        <span class="keyword">return</span> <span class="keyword">new</span> Four(<span class="keyword">this</span>.struct[<span class="number">0</span>], <span class="keyword">this</span>.struct[<span class="number">1</span>], <span class="keyword">this</span>.struct[<span class="number">2</span>], obj);
      };

      TripleDequelette.prototype.removeLeft = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">return</span> <span class="keyword">new</span> Two(<span class="keyword">this</span>.struct[<span class="number">1</span>], <span class="keyword">this</span>.struct[<span class="number">2</span>]);
      };

      TripleDequelette.prototype.removeRight = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">return</span> <span class="keyword">new</span> Two(<span class="keyword">this</span>.struct[<span class="number">0</span>], <span class="keyword">this</span>.struct[<span class="number">1</span>]);
      };

      TripleDequelette.prototype.val = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">return</span> <span class="keyword">this</span>.struct;
      };

      <span class="keyword">return</span> TripleDequelette;

    }();</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>A dequelette with four objects.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> Four = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>

      QuatrupleDequelette.prototype.VERSION = VERSION;

      QuatrupleDequelette.prototype.TYPE = <span class="string">'four'</span>;

      <span class="function"><span class="keyword">function</span> <span class="title">QuatrupleDequelette</span><span class="params">(obj1, obj2, obj3, obj4)</span> {</span>
        <span class="keyword">this</span>.struct = [obj1, obj2, obj3, obj4];
      }

      QuatrupleDequelette.prototype.size = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">return</span> <span class="number">4</span>;
      };

      QuatrupleDequelette.prototype.peekLeft = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">return</span> <span class="keyword">this</span>.struct[<span class="number">0</span>];
      };

      QuatrupleDequelette.prototype.peekRight = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">return</span> <span class="keyword">this</span>.struct[<span class="number">3</span>];
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>This should never happen.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      QuatrupleDequelette.prototype.insertLeft = <span class="function"><span class="keyword">function</span> <span class="params">(obj)</span> {</span>
        <span class="keyword">return</span> <span class="keyword">this</span>;
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>This should never happen.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      QuatrupleDequelette.prototype.insertRight = <span class="function"><span class="keyword">function</span> <span class="params">(obj)</span> {</span>
        <span class="keyword">return</span> <span class="keyword">this</span>;
      };

      QuatrupleDequelette.prototype.removeLeft = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">return</span> <span class="keyword">new</span> Three(<span class="keyword">this</span>.struct[<span class="number">1</span>], <span class="keyword">this</span>.struct[<span class="number">2</span>], <span class="keyword">this</span>.struct[<span class="number">3</span>]);
      };

      QuatrupleDequelette.prototype.removeRight = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">return</span> <span class="keyword">new</span> Three(<span class="keyword">this</span>.struct[<span class="number">0</span>], <span class="keyword">this</span>.struct[<span class="number">1</span>], <span class="keyword">this</span>.struct[<span class="number">2</span>]);
      };

      QuatrupleDequelette.prototype.val = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">return</span> <span class="keyword">this</span>.struct;
      };

      <span class="keyword">return</span> QuatrupleDequelette;

    }();

    <span class="keyword">return</span> Dequelette;

  }();</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>The <code>deque</code> below is based on an <a href="http://blogs.msdn.com/b/ericlippert/archive/2008/02/12/immutability-in-c-part-eleven-a-working-double-ended-queue.aspx">article by Eric Lippert</a>
and is used by a finger tree as a base structure upon which the tree is built. It can be one of three things:
1. empty
2. a single element of a particular type T
3. a left dequelette of T, followed by a middle deque of dequelettes of T, followed by a right dequelette of T.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _struct.fdeque = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>

    Deque.prototype.VERSION = VERSION;</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>The constructor creates a Deque of a specific type depending on the number of elements provided.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="function"><span class="keyword">function</span> <span class="title">Deque</span><span class="params">(arr)</span> {</span>
      <span class="keyword">if</span> (_.isArray(arr)) {
        <span class="keyword">if</span> (arr.length === <span class="number">0</span>)
          <span class="keyword">return</span> <span class="keyword">new</span> One(arr);
        <span class="keyword">else</span> <span class="keyword">if</span> (arr.length === <span class="number">2</span>)
          <span class="keyword">return</span> <span class="keyword">new</span> Two(arr[<span class="number">0</span>], arr[<span class="number">1</span>]);
        <span class="keyword">else</span> <span class="keyword">if</span> (arr.length === <span class="number">3</span>)
          <span class="keyword">return</span> <span class="keyword">new</span> Three(arr[<span class="number">0</span>], arr[<span class="number">1</span>], arr[<span class="number">2</span>]);
        <span class="keyword">else</span> <span class="keyword">if</span> (arr.length === <span class="number">4</span>)
          <span class="keyword">return</span> <span class="keyword">new</span> Four(arr[<span class="number">0</span>], arr[<span class="number">1</span>], arr[<span class="number">2</span>], arr[<span class="number">3</span>]);
      }
      <span class="keyword">else</span> <span class="keyword">if</span> (arr)
        <span class="keyword">return</span> <span class="keyword">new</span> SingleDeque(arr);
      <span class="keyword">else</span>
        <span class="keyword">return</span> <span class="keyword">new</span> EmptyDeque();
    }

    <span class="keyword">return</span> Deque;
  }();</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <h2>Underscore Finger Tree</h2>

            </div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>A finger tree is essentially the swiss army knife of functional data structures.
It provides a general-purpose simple and efficient way for &quot;accessing and removing elements 
at both ends, concatenatation, insertion and deletion at arbitrary points, finding an element
satisfying some criterion, and splitting the sequence into subsequences based on some property.&quot;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  structs.fingertree = _struct.fingertree = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>

    FingerTree.prototype.VERSION = VERSION;</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Creates a finger tree object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="function"><span class="keyword">function</span> <span class="title">FingerTree</span><span class="params">()</span> {</span>
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Exports a finger tree instance for use in an <strong>Underscore.js</strong> mixin.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    FingerTree.prototype._exports = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
      <span class="keyword">return</span> {
        fingertree: <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
          <span class="keyword">return</span> <span class="keyword">new</span> FingerTree();
        }
      };
    };

    <span class="keyword">return</span> FingerTree;

  }();</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Mix-in a function to mix-in a hash of structs to the <strong>Underscore.js</strong> library.
This can be used to add your own custom structs to the library.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.mixin({
    struct: <span class="function"><span class="keyword">function</span> <span class="params">(structs)</span> {</span>
      _.each(structs, <span class="function"><span class="keyword">function</span> <span class="params">(struct, key)</span> {</span>
        _.mixin(<span class="keyword">new</span> struct()._exports());
      });
    }
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Add all struct objects to the <strong>Underscore.js</strong> library.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.struct(structs);

}).call(<span class="keyword">this</span>);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
